<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Birthday Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,700;1,700&family=Caveat:wght@400;700&family=Montserrat:wght@300;400;700;900&family=Orbitron:wght@400;700;900&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    <!-- Hebcal Library for date conversion -->
    <script src="https://cdn.jsdelivr.net/npm/@hebcal/core@latest/dist/bundle.min.js"></script>
    <style>
        :root {
            --bg-image: none;
            --bg-color: #f8fafc;
            --card-bg: rgba(255, 255, 255, 0.9);
            --accent: #6366f1;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --font-family: 'Inter', sans-serif;
            --border-radius: 1.25rem;
        }

        .theme-modern {
            --bg-image: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
            --accent: #4f46e5;
            --font-family: 'Montserrat', sans-serif;
        }

        .theme-warm {
            --bg-image: url('https://images.unsplash.com/photo-1516550135131-fe3dcb0bedc7?auto=format&fit=crop&q=80&w=2000');
            --bg-color: #fdf6e3;
            --card-bg: rgba(253, 252, 240, 0.92);
            --accent: #b45309;
            --text-main: #451a03;
            --font-family: 'Caveat', cursive;
        }

        .theme-dark {
            --bg-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?auto=format&fit=crop&q=80&w=2000');
            --bg-color: #020617;
            --card-bg: rgba(15, 23, 42, 0.85);
            --accent: #38bdf8;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --font-family: 'Orbitron', sans-serif;
        }

        .theme-spring {
            --bg-image: url('https://images.unsplash.com/photo-1490750967868-88aa4486c946?auto=format&fit=crop&q=80&w=2000');
            --card-bg: rgba(255, 255, 255, 0.85);
            --accent: #15803d;
            --text-main: #064e3b;
            --font-family: 'Quicksand', sans-serif;
        }

        .theme-serif {
            --bg-image: url('https://images.unsplash.com/photo-1513519245088-0e12902e5a38?auto=format&fit=crop&q=80&w=2000');
            --card-bg: rgba(255, 255, 255, 0.95);
            --accent: #431407;
            --text-main: #1c1917;
            --font-family: 'Playfair Display', serif;
        }

        body {
            background: var(--bg-image) fixed center center / cover;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            transition: all 0.5s ease;
            min-height: 100vh;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .month-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            break-inside: avoid;
        }

        .month-card:hover { transform: translateY(-8px); }

        .month-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
            margin-bottom: 1.25rem;
            padding-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .person-avatar {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent);
            background-color: var(--bg-color);
        }

        .theme-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 9999px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0,0,0,0.1);
            font-family: 'Inter', sans-serif;
        }

        .theme-btn.active {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .input-field {
            background: rgba(255,255,255,0.9);
            border: 1px solid rgba(0,0,0,0.1);
            padding: 0.6rem;
            border-radius: 0.75rem;
            width: 100%;
            color: #1e293b;
        }

        .date-type-toggle {
            display: inline-flex;
            background: #e2e8f0;
            border-radius: 0.5rem;
            padding: 2px;
            margin-bottom: 0.5rem;
        }

        .date-type-toggle button {
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: bold;
            border-radius: 0.4rem;
            transition: all 0.2s;
        }

        .date-type-toggle button.active {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        @media print {
            header, .no-print, #addForm-section, .theme-btn, .print-trigger-btn { display: none !important; }
            body { background: none !important; background-color: white !important; color: black !important; padding: 0 !important; }
            .calendar-grid { grid-template-columns: repeat(4, 1fr) !important; gap: 8mm !important; }
            .month-card { box-shadow: none !important; border: 0.5pt solid #ddd !important; background: white !important; }
            .page-break { page-break-before: always; }
            .calendar-section { margin-top: 2rem; }
        }

        #modal-backdrop {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="theme-modern p-4 md:p-8">

    <!-- Modal -->
    <div id="modal-backdrop">
        <div class="bg-white p-8 rounded-3xl max-w-md w-full mx-4 shadow-2xl" style="background-color: var(--card-bg); color: var(--text-main);">
            <h2 class="text-2xl font-bold mb-4">Edit Entry</h2>
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="edit-id">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="block text-xs uppercase font-bold mb-1 opacity-60">English Name</label>
                        <input type="text" id="edit-name" required class="input-field">
                    </div>
                    <div>
                        <label class="block text-xs uppercase font-bold mb-1 opacity-60">Hebrew Name</label>
                        <input type="text" id="edit-name-he" required dir="rtl" class="input-field">
                    </div>
                </div>
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-xs uppercase font-bold opacity-60">Birthday</label>
                        <div class="date-type-toggle">
                            <button type="button" onclick="setEntryDateType('edit', 'greg')" id="edit-type-greg" class="active">Gregorian</button>
                            <button type="button" onclick="setEntryDateType('edit', 'heb')" id="edit-type-heb">Hebrew</button>
                        </div>
                    </div>
                    
                    <div id="edit-greg-container">
                        <input type="date" id="edit-dob" class="input-field">
                    </div>
                    
                    <div id="edit-heb-container" class="hidden grid grid-cols-3 gap-2">
                        <select id="edit-heb-day" class="input-field"></select>
                        <select id="edit-heb-month" class="input-field"></select>
                        <select id="edit-heb-year" class="input-field"></select>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2 pt-4">
                    <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold flex-1">Save</button>
                    <button type="button" onclick="removeMember()" class="bg-red-500 text-white px-6 py-2 rounded-xl font-bold">Delete</button>
                    <button type="button" onclick="closeModal()" class="px-6 py-2 border rounded-xl font-bold">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <header class="max-w-7xl mx-auto mb-12">
        <div class="flex flex-col md:flex-row md:items-end justify-between gap-8">
            <div class="bg-white/40 p-6 rounded-3xl backdrop-blur-md border border-white/40 shadow-xl">
                <h1 class="text-5xl font-extrabold tracking-tighter mb-2 italic">Family Calendar</h1>
                <p class="opacity-80 text-lg">Two traditions, one family journey.</p>
            </div>
            
            <div class="flex flex-col gap-3 items-end no-print">
                <div class="flex flex-wrap gap-2 p-2 rounded-2xl bg-black/5 backdrop-blur-sm border border-black/5">
                    <button onclick="setTheme('modern')" class="theme-btn active" id="btn-modern">Modern</button>
                    <button onclick="setTheme('warm')" class="theme-btn" id="btn-warm">Warm</button>
                    <button onclick="setTheme('dark')" class="theme-btn" id="btn-dark">Night</button>
                    <button onclick="setTheme('spring')" class="theme-btn" id="btn-spring">Spring</button>
                    <button onclick="setTheme('serif')" class="theme-btn" id="btn-serif">Classic</button>
                </div>
                <button onclick="triggerPrint()" class="bg-white/80 hover:bg-white text-black px-6 py-2 rounded-full font-bold shadow-lg transition-all flex items-center gap-2 print-trigger-btn">
                    üñ®Ô∏è Print 2-Page Calendar
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto">
        <!-- Add Member Form -->
        <section id="addForm-section" class="mb-12 no-print bg-white/30 p-8 rounded-3xl border border-white/50 backdrop-blur-xl shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <span class="bg-white p-2 rounded-full shadow-inner">üë§</span> Add Someone New
            </h2>
            <form id="addForm" class="grid grid-cols-1 md:grid-cols-5 gap-6 items-end">
                <div>
                    <label class="block text-xs uppercase font-black mb-2 opacity-70">English Name</label>
                    <input type="text" id="name" required class="input-field" placeholder="Aunt Sarah">
                </div>
                <div>
                    <label class="block text-xs uppercase font-black mb-2 opacity-70">Hebrew Name</label>
                    <input type="text" id="name_he" required dir="rtl" class="input-field" placeholder="◊©◊®◊î ◊ì◊ï◊ì◊î">
                </div>
                <div class="md:col-span-1">
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-xs uppercase font-black opacity-70">Birthday</label>
                        <div class="date-type-toggle">
                            <button type="button" onclick="setEntryDateType('add', 'greg')" id="add-type-greg" class="active">Gregorian</button>
                            <button type="button" onclick="setEntryDateType('add', 'heb')" id="add-type-heb">Hebrew</button>
                        </div>
                    </div>
                    
                    <div id="add-greg-container">
                        <input type="date" id="dob" class="input-field">
                    </div>
                    
                    <div id="add-heb-container" class="hidden grid grid-cols-3 gap-1">
                        <select id="add-heb-day" class="input-field text-xs px-1"></select>
                        <select id="add-heb-month" class="input-field text-xs px-1"></select>
                        <select id="add-heb-year" class="input-field text-xs px-1"></select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs uppercase font-black mb-2 opacity-70">Picture (Optional)</label>
                    <input type="file" id="photo" accept="image/*" class="input-field text-sm">
                </div>
                <button type="submit" class="bg-black text-white px-8 py-3 rounded-xl font-bold hover:scale-105 transition-transform shadow-xl">
                    Add Member
                </button>
            </form>
        </section>

        <!-- Gregorian Calendar Section -->
        <div class="calendar-section">
            <h2 class="text-3xl font-black mb-8 border-l-8 border-indigo-500 pl-4 uppercase tracking-tighter">Gregorian Calendar</h2>
            <div id="calendar-gregorian" class="calendar-grid mb-20"></div>
        </div>

        <div class="page-break"></div>

        <!-- Hebrew Calendar Section -->
        <div class="calendar-section">
            <h2 class="text-3xl font-black mb-8 border-l-8 border-emerald-500 pl-4 uppercase tracking-tighter">Hebrew Calendar</h2>
            <div id="calendar-hebrew" class="calendar-grid pb-20" dir="rtl"></div>
        </div>
    </main>

    <script>
        const monthNamesEn = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const monthNamesHe = ["◊™◊©◊®◊ô", "◊ó◊©◊ï◊ï◊ü", "◊õ◊°◊ú◊ï", "◊ò◊ë◊™", "◊©◊ë◊ò", "◊ê◊ì◊®", "◊†◊ô◊°◊ü", "◊ê◊ô◊ô◊®", "◊°◊ô◊ï◊ï◊ü", "◊™◊û◊ï◊ñ", "◊ê◊ë", "◊ê◊ú◊ï◊ú"];

        const hebMonthsList = [
            "Nisan", "Iyyar", "Sivan", "Tamuz", "Av", "Elul", "Tishrei", "Cheshvan", "Kislev", "Tevet", "Shvat", "Adar I", "Adar II"
        ];
        
        let familyMembers = [];
        let activeDateType = { add: 'greg', edit: 'greg' };

        function initHebrewDropdowns(prefix) {
            const daySelect = document.getElementById(`${prefix}-heb-day`);
            const monthSelect = document.getElementById(`${prefix}-heb-month`);
            const yearSelect = document.getElementById(`${prefix}-heb-year`);

            daySelect.innerHTML = Array.from({length: 30}, (_, i) => `<option value="${i+1}">${i+1}</option>`).join('');
            monthSelect.innerHTML = hebMonthsList.map(m => `<option value="${m}">${m}</option>`).join('');
            
            const currentHebYear = new hebcal.HDate(new Date()).getFullYear();
            yearSelect.innerHTML = Array.from({length: 120}, (_, i) => `<option value="${currentHebYear - i}">${currentHebYear - i}</option>`).join('');
        }

        function setEntryDateType(form, type) {
            activeDateType[form] = type;
            document.getElementById(`${form}-type-greg`).classList.toggle('active', type === 'greg');
            document.getElementById(`${form}-type-heb`).classList.toggle('active', type === 'heb');
            document.getElementById(`${form}-greg-container`).classList.toggle('hidden', type === 'heb');
            document.getElementById(`${form}-heb-container`).classList.toggle('hidden', type === 'greg');
        }

        function setTheme(theme) {
            document.body.className = `theme-${theme} p-4 md:p-8`;
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${theme}`).classList.add('active');
        }

        function triggerPrint() { window.focus(); setTimeout(() => window.print(), 250); }

        function openEditModal(id) {
            const m = familyMembers.find(m => m.id === id);
            if (!m) return;
            document.getElementById('edit-id').value = m.id;
            document.getElementById('edit-name').value = m.name;
            document.getElementById('edit-name-he').value = m.name_he;
            
            if (m.dateType === 'heb') {
                setEntryDateType('edit', 'heb');
                document.getElementById('edit-heb-day').value = m.hebData.day;
                document.getElementById('edit-heb-month').value = m.hebData.month;
                document.getElementById('edit-heb-year').value = m.hebData.year;
            } else {
                setEntryDateType('edit', 'greg');
                document.getElementById('edit-dob').value = m.rawDate;
            }
            
            document.getElementById('modal-backdrop').style.display = 'flex';
        }

        function closeModal() { document.getElementById('modal-backdrop').style.display = 'none'; }

        function removeMember() {
            const id = document.getElementById('edit-id').value;
            familyMembers = familyMembers.filter(m => m.id !== id);
            closeModal();
            renderCalendar();
        }

        function processDate(form) {
            const type = activeDateType[form];
            let dob, rawDate, hebData = null;

            if (type === 'greg') {
                rawDate = document.getElementById(form === 'add' ? 'dob' : 'edit-dob').value;
                dob = new Date(rawDate);
                if (isNaN(dob.getTime())) return null;
                const hDate = new hebcal.HDate(dob);
                hebData = { 
                    day: hDate.getDate(), 
                    month: hDate.getMonthName(), 
                    year: hDate.getFullYear(),
                    hebMonthIndex: getHebrewMonthIndex(hDate.getMonthName())
                };
            } else {
                const d = parseInt(document.getElementById(`${form}-heb-day`).value);
                const m = document.getElementById(`${form}-heb-month`).value;
                const y = parseInt(document.getElementById(`${form}-heb-year`).value);
                
                try {
                    const hDate = new hebcal.HDate(d, m, y);
                    dob = hDate.greg();
                    rawDate = dob.toISOString().split('T')[0];
                    hebData = { 
                        day: d, 
                        month: m, 
                        year: y,
                        hebMonthIndex: getHebrewMonthIndex(m)
                    };
                } catch(e) { return null; }
            }

            return { dob, rawDate, type, hebData };
        }

        function getHebrewMonthIndex(monthName) {
            // Tishrei is the 1st month in the civil-leaning monthNamesHe array but Hebcal index varies.
            // Mapping Hebcal names to monthNamesHe index (0-11)
            const map = {
                "Tishrei": 0, "Cheshvan": 1, "Kislev": 2, "Tevet": 3, "Shvat": 4, 
                "Adar": 5, "Adar I": 5, "Adar II": 5, 
                "Nisan": 6, "Iyyar": 7, "Sivan": 8, "Tamuz": 9, "Av": 10, "Elul": 11
            };
            return map[monthName] ?? 0;
        }

        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const result = processDate('edit');
            if (!result) return;

            const id = document.getElementById('edit-id').value;
            const index = familyMembers.findIndex(m => m.id === id);
            if (index !== -1) {
                familyMembers[index].name = document.getElementById('edit-name').value;
                familyMembers[index].name_he = document.getElementById('edit-name-he').value;
                familyMembers[index].month = result.dob.getUTCMonth();
                familyMembers[index].day = result.dob.getUTCDate();
                familyMembers[index].rawDate = result.rawDate;
                familyMembers[index].dateType = result.type;
                familyMembers[index].hebData = result.hebData;
            }
            closeModal();
            renderCalendar();
        });

        function renderCalendar() {
            // Render Gregorian
            const gregContainer = document.getElementById('calendar-gregorian');
            gregContainer.innerHTML = '';
            monthNamesEn.forEach((monthName, index) => {
                const members = familyMembers
                    .filter(m => m.month === index)
                    .sort((a, b) => a.day - b.day);
                gregContainer.appendChild(createMonthCard(monthName, members, 'en'));
            });

            // Render Hebrew
            const hebContainer = document.getElementById('calendar-hebrew');
            hebContainer.innerHTML = '';
            monthNamesHe.forEach((monthName, index) => {
                const members = familyMembers
                    .filter(m => m.hebData.hebMonthIndex === index)
                    .sort((a, b) => a.hebData.day - b.hebData.day);
                hebContainer.appendChild(createMonthCard(monthName, members, 'he'));
            });
        }

        function createMonthCard(title, members, lang) {
            const card = document.createElement('div');
            card.className = 'month-card';
            
            let contentHtml = members.length === 0 
                ? `<p class="text-sm opacity-30 italic py-4">${lang === 'en' ? "Quiet month..." : "◊ó◊ï◊ì◊© ◊©◊ß◊ò..."}</p>`
                : members.map(m => `
                    <div onclick="openEditModal('${m.id}')" class="flex items-center gap-4 mb-5 group cursor-pointer hover:bg-black/5 p-2 -m-2 rounded-2xl transition-all">
                        <img src="${m.photo}" alt="${m.name}" class="person-avatar shadow-md group-hover:rotate-3 transition-transform">
                        <div class="overflow-hidden">
                            <h3 class="font-bold text-lg truncate leading-tight">${lang === 'en' ? m.name : m.name_he}</h3>
                            <p class="text-xs font-black uppercase tracking-widest opacity-50">
                                ${lang === 'en' ? (m.day + getOrdinal(m.day)) : (m.hebData.day + ' ◊ë' + title)}
                                ${lang === 'en' ? ` ‚Ä¢ ${m.hebData.day} ${m.hebData.month}` : ` ‚Ä¢ ${m.day}/${m.month+1}`}
                            </p>
                        </div>
                    </div>
                `).join('');

            card.innerHTML = `<h2 class="month-title">${title}</h2><div class="members-list">${contentHtml}</div>`;
            return card;
        }

        function getOrdinal(d) {
            if (d > 3 && d < 21) return 'th';
            switch (d % 10) {
                case 1: return "st"; case 2: return "nd"; case 3: return "rd"; default: return "th";
            }
        }

        document.getElementById('addForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const result = processDate('add');
            if (!result) return;

            const name = document.getElementById('name').value;
            const name_he = document.getElementById('name_he').value;
            const photoInput = document.getElementById('photo');

            const addMember = (photoUrl) => {
                familyMembers.push({
                    id: Date.now().toString(),
                    name: name,
                    name_he: name_he,
                    month: result.dob.getUTCMonth(),
                    day: result.dob.getUTCDate(),
                    rawDate: result.rawDate,
                    dateType: result.type,
                    hebData: result.hebData,
                    photo: photoUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&size=128&background=random&bold=true`
                });
                renderCalendar();
                e.target.reset();
                setEntryDateType('add', 'greg');
            };

            if (photoInput.files && photoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => addMember(event.target.result);
                reader.readAsDataURL(photoInput.files[0]);
            } else { addMember(null); }
        });

        initHebrewDropdowns('add');
        initHebrewDropdowns('edit');
        renderCalendar();
    </script>
</body>
</html>
